{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./main.js","webpack:///./src/emitter.js","webpack:///./src/helpers.js","webpack:///./src/index.js"],"names":["isConnecter","url","whitelist","window","console","error","Wedding","Emitter","on","name","fn","events","Error","emit","frame","contentWindow","postMessage","parent","origin","e","off","undefined","attachListener","createConnection","createConnectionListener","validateConstructor","initEvents","statuses","disconnected","connecting","connected","data","includes","document","createElement","src","style","display","body","append","frameDoc","contentDocument","readyState","info","connectionInterval","setInterval","status","setTimeout","bind","addEventListener","attachEvent","length","clearInterval","Object","create","call","connect","onStart"],"mappings":"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","file":"wedding.amd.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// @flow\nimport type { WeddingType, ArgsType } from './src/types';\nimport Wedding from './src/index';\nimport { validateConstructor } from './src/helpers';\n\nexport default ({\n  isConnecter = false,\n  url = '',\n  whitelist = []\n}: ArgsType = {}): ?WeddingType => {\n  if (typeof window === 'undefined') {\n    console.error('Connector does not work in SSR');\n    return null;\n  }\n\n  // Validate before construct\n  validateConstructor(isConnecter, url, whitelist);\n\n  return new Wedding({ isConnecter, url, whitelist });\n};\n","// @flow\nimport type { OnFunction, Events } from './types';\n\nexport default class Emitter {\n  events: Events | any;\n  isConnecter: boolean;\n  url: string;\n  origin: string;\n  frame: any;\n\n  on(name: string, fn: OnFunction): void {\n    if (this.events[name]) {\n      throw new Error(`${name} - event listner already exists`);\n    }\n\n    this.events = Object.assign(this.events, { [name]: fn });\n  }\n\n  emit(name: string): void {\n    try {\n      if (this.isConnecter) {\n        this.frame.contentWindow.postMessage(name, this.url);\n      } else {\n        window.parent.postMessage(name, this.origin);\n      }\n    } catch (e) {\n      throw new Error(`${e} - Postmessage error on emit`);\n    }\n  }\n\n  off(name: string): void {\n    if (!this.events[name]) {\n      throw new Error(`${name} - event listner does not exists`);\n    }\n\n    this.events = Object.assign({}, { [name]: undefined });\n  }\n}\n","export const statuses = {\n  disconnected: 'disconnected',\n  connecting: 'connecting',\n  connected: 'connected',\n};\n\nexport function attachListener({ origin, data }) {\n  if (!this.whitelist.includes(origin)) {\n    throw new Error(`${origin} - is not included in whitelist`);\n  }\n\n  this.origin = origin;\n\n  if (this.events[data]) {\n    this.events[data]();\n  }\n}\n\n// Create connection function\n// creates iFrame and trying to connect inside with interval\nexport function createConnection() {\n  const frame = document.createElement('iframe');\n\n  Object.assign(frame, {\n    name: 'theFionce',\n    src: this.url,\n    style: {\n      display: 'none',\n    },\n  });\n\n  document.body.append(frame);\n  const frameDoc = frame.contentDocument || frame.contentWindow.document;\n\n  if (frameDoc.readyState === 'complete') {\n    console.info('Frame loaded');\n\n    this.frame = frame;\n\n    this.connectionInterval = setInterval(() => {\n      this.emit('connection:start');\n    }, 1000);\n\n    this.status = statuses.connecting;\n    return;\n  }\n\n  setTimeout(createConnection.bind(this), 500);\n}\n\n// Create connection listner on window\nexport function createConnectionListener() {\n  if (window.addEventListener) {\n    window.addEventListener('message', attachListener.bind(this), false);\n  } else {\n    window.attachEvent('onmessage', attachListener.bind(this));\n  }\n}\n\n// Validations\nexport function validateConstructor(isConnecter, url, whitelist) {\n  if (isConnecter && url === '') {\n    throw new Error('Please provide correct url for connections');\n  }\n\n  if (whitelist.length === 0) {\n    throw new Error('Please provide whitelist for connections');\n  }\n}\n\n// Default events\nexport function initEvents() {\n  this.on('connection:start', () => {\n    this.emit('connection:finished');\n    this.emit('start');\n  });\n\n  this.on('connection:finished', () => {\n    clearInterval(this.connectionInterval);\n    this.status = statuses.connected;\n\n    console.info('Connection established');\n  });\n}\n","// @flow\nimport type { ArgsType, WeddingType, Events, Status, OnFunction } from './types';\nimport Emitter from './emitter';\nimport { createConnection, createConnectionListener, statuses, initEvents } from './helpers';\n\nexport default class Wedding extends Emitter {\n  whitelist: Array<string>;\n  connectionInterval: any;\n  status: Status;\n\n  constructor({\n    isConnecter,\n    url,\n    whitelist\n  }: ArgsType): void {\n    super();\n\n    Object.assign(this, {\n      events: Object.create(null),\n      isConnecter,\n      url,\n      whitelist,\n      origin: '',\n      frame: null,\n      connectionInterval: null,\n      status: statuses.disconnected,\n    });\n\n    createConnectionListener.call(this);\n    initEvents.call(this);\n  }\n\n  connect(onStart: ?OnFunction = null): void {\n    if (!this.isConnecter) {\n      throw new Error('This is not a connector');\n    }\n\n    if (typeof onStart !== 'function') {\n      throw new Error('Please provide onStart callback');\n    }\n\n    console.info('Initializing connection');\n\n    this.on('start', onStart);\n    createConnection.call(this);\n  }\n}\n"],"sourceRoot":""}